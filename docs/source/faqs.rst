##########################
Frequently Asked Questions
##########################

**-- How precise the redshift of my source needs to be?**

``CAFE`` is not a redshift finder, so the redshift should be at least as precise as the resolving power (FWHM) of the instrument used to obtain the data. ``CAFE`` performs an initial search for the emission lines the user has requested to fit via the *lines.H.recombination_?.txt*, *lines.atomic_?.txt* and *lines.molecular_?.txt* files contained in the *CAFE/inp_parfiles/* folder. The search is done at the expected rest-frame wavelength of the line (after correcting the observed spectrum to rest frame), so if the redshift is not correct, or the line is too red/blue-shifted with respect to the systemic redshift, the finder will fail and ``CAFE`` will ignore the line and will not attempt to fit it. The list of ignored lines are printed in the output given by the jupyter notebook cell that calls for the fit.


**-- Can I fit high redshift sources with ``CAFE``?**

In principle yes, but there is one main caveat to bear in mind. The emission line table that ``CAFE`` uses goes down to the ultraviolet domain, and the user can add more lines to that table if they wish. The amount of continuum components available for fitting is large and sufficiently versatile to capture the shape of the near and mid-IR spectra of sources, even the most embedded ones. However, when trying to fit spectra at wavelengths < 1 micron rest-frame, care should be taken. Below ~2-3 micron, where the hottest of the dust components starts to contribute less significantly to the emission, ``CAFE`` uses direct-light template sources to reproduce the observed continuum (see :ref:`Spectral Fitting<fit_spec.rst>`). These templates are: an AGN accretion-disk component (*DSK*), an average interstellar radiation field (*STR*), and up to three single stellar population (SSP) templates from the SB99 library to account for recent star formation (2, 10 and 100Myr age starbursts). These comonents are enough to characterize the spectral shapes of the vast majority of sources in the near-IR, but when the wavelength range to be fitted extends well below rest-frame ~1 micron (likely the case for high redshift sources observed with NIRSpec/IFU in the shortest wavelength gratings: G140X or G235X), they may not be sufficient to capture the complexity of the continuum below the emission lines in the spectrum, potentially leading to very poor fits in the rest-frame optical and UV.


**-- What if some of the emission lines in my spectrum have a broad component?**

``CAFE`` can fit up to two Gaussian components to a given emission line. In particular, the user can set up specific emission lines to be fitted with a narrow and a broad component. Please note, however, that while the parameters (peak, gamma/width and wavelength) of each line component are fitted independently, the constraints that the user can put on them (i.e., whether to vary/fit them, and if so, by how much they are allowed to change from the initial value) will affect all narrow components at once, and separately, all broad components at once. To assign a broad component to the default narrow component of a line, the user needs to use the last column (setting the value of the DOUBLE column to 1) found in the tables that control which lines ``CAFE`` will try to fit; that is, the *lines.H.recombination_?.txt*, *lines.atomic_?.txt* and *lines.molecular_?.txt* files contained in the *CAFE/inp_parfiles/* folder. Then, the user can control the behavior/constraints of the parameters in the **[PAH & LINE OPTIONS]** section in the *.ini* file (see :ref:`Spectral Fitting<fit_spec.rst>` section).


**-- Can I add and fit photometry together with my spectrum?**

Yes, photometric data can be included as part of the fit in order to better constrain the SED of the source at wavelengths beyond those covered by the spectral data. The photometry is ingested from a table that needs to contain the following columns: (1) name of the filter, (2) central wavelength (in [um]), (3) flux density (in [Jy]), (4) flux density uncertainty, and (5) width of the filter (in [um]); (header/title/comment lines must be preceeded by a #). If the width of the filter is unknown it should be set to a value of 0.0, in which case the spectrum will not be convolved with the filter bandpass width but instead will be evaluated monochromatically. The photometric data is imported via the ``cafe.read_phot()`` command, similar to how a spectrum is ingested, if it is read from a simple *.dat* or *.txt* file. In addition to the data, the user needs to use the *photometry_opt.cafe* file instead of the *default_opt.cafe* as the options parameter file, within the *opt_parfiles/* folder.
